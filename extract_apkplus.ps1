# Define the directory containing the .apk+ files
$apkDir = ".\files"

# Navigate to the directory
Set-Location -Path $apkDir

# Get all .apk+ files in the directory
$apkPlusFiles = Get-ChildItem -Filter "*.apk+"

# Loop through each .apk+ file
foreach ($apkPlusFile in $apkPlusFiles) {
    # Strip the "+" and create the new apk name
    $apkName = [System.IO.Path]::GetFileNameWithoutExtension($apkPlusFile.Name)

    # Rename .apk+ to .zip
    $zipFile = "$apkName.zip"
    Rename-Item -Path $apkPlusFile.FullName -NewName $zipFile

    # Create a folder for extracting
    $extractDir = Join-Path -Path $apkDir -ChildPath $apkName

    # Extract base.apk from the zip into a directory
    Expand-Archive -Path $zipFile -DestinationPath $extractDir

    # Rename base.apk to {apkName}.apk
    $newApkName = "$apkName.apk"
    Rename-Item -Path (Join-Path -Path $extractDir -ChildPath "base.apk") -NewName $newApkName

    # Move the renamed apk back to the original directory
    Move-Item -Path (Join-Path -Path $extractDir -ChildPath $newApkName) -Destination $apkDir

    # Clean up: remove the temporary extracted directory and the .zip file
    Remove-Item -Path $extractDir -Recurse
    Remove-Item -Path $zipFile
}
